# Migration `20201204161750-oauth-github`

This migration has been generated by Southclaws at 12/4/2020, 4:17:50 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."AuthMethod" AS ENUM ('GITHUB')

DROP INDEX "User.verify_key_unique"

ALTER TABLE "User" DROP COLUMN "pass",
DROP COLUMN "verify_key",
DROP COLUMN "verified_at",
ADD COLUMN     "authMethod" "AuthMethod" NOT NULL

CREATE TABLE "GitHub" (
    "userId" TEXT NOT NULL,
    "accountId" TEXT NOT NULL,
    "username" TEXT NOT NULL,
    "email" TEXT NOT NULL,

    PRIMARY KEY ("userId")
)

CREATE UNIQUE INDEX "GitHub.accountId_unique" ON "GitHub"("accountId")

CREATE UNIQUE INDEX "GitHub.username_unique" ON "GitHub"("username")

CREATE UNIQUE INDEX "GitHub.email_unique" ON "GitHub"("email")

CREATE UNIQUE INDEX "GitHub_userId_unique" ON "GitHub"("userId")

ALTER TABLE "GitHub" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201120005130-verification-key-unique..20201204161750-oauth-github
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider      = "go run github.com/prisma/prisma-client-go"
@@ -9,22 +9,35 @@
   package       = "db"
   binaryTargets = ["native"]
 }
+enum AuthMethod {
+  GITHUB
+}
+
 model User {
-  id      String   @id @default(uuid())
-  email   String   @unique
-  name    String
-  pass    String
-  admin   Boolean  @default(false)
+  id         String     @id @default(uuid())
+  email      String     @unique
+  authMethod AuthMethod
+  github     GitHub?
+  // discord Discord?
+
+  name  String
+  admin Boolean @default(false)
+
   servers Server[]
-  // Account verification key - emailed to user
-  verify_key String @unique
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+}
-  createdAt   DateTime  @default(now())
-  updatedAt   DateTime  @updatedAt
-  verified_at DateTime? // only set when account is verified
+model GitHub {
+  userId String @id
+  user   User   @relation(fields: [userId], references: [id])
+
+  accountId String @unique
+  username  String @unique
+  email     String @unique
 }
 model Server {
   id String @id @default(uuid())
```


